<!doctype html><html lang=ja-jp prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="10. 直線探索"><meta property="og:site_name" content="Manifold Optimization"><meta property="og:image" content><meta property="og:image:type" content="image/jpeg"><meta property="og:image:width" content><meta property="og:image:height" content><meta property="og:url" content="https://nineties.github.io/manifold-optimization/10-linesearch/"><meta property="og:locale" content="ja-jp"><meta property="article:published_time" content="0001-01-01
"><meta property="article:modified_time" content="0001-01-01
"><title>10. 直線探索</title><link rel=canonical href=https://nineties.github.io/manifold-optimization/10-linesearch/><link rel=stylesheet href=https://unpkg.com/tachyons@4.11.1/css/tachyons.min.css><link rel=stylesheet href=https://nineties.github.io/manifold-optimization/css/style.css><link rel=stylesheet href=https://nineties.github.io/manifold-optimization/css/custom.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/highlightjs@9.12.0/styles/github-gist.css><link rel=stylesheet type=text/css href=https://nineties.github.io/manifold-optimization/css/mathjax-style.css><script>MathJax={tex:{inlineMath:[['$','$']],displayMath:[['$$','$$']],processEscapes:!0,tags:"ams",autoload:{color:[],colorV2:['color']},packages:{'[+]':['noerrors']}},chtml:{matchFontHeight:!1,displayAlign:"left",displayIndent:"2em"},options:{renderActions:{find_script_mathtex:[10,function(a){for(const b of document.querySelectorAll('script[type^="math/tex"]')){const e=!!b.type.match(/; *mode=display/),c=new a.options.MathItem(b.textContent,a.inputJax[0],e),d=document.createTextNode('');b.parentNode.replaceChild(d,b),c.start={node:d,delim:'',n:0},c.end={node:d,delim:'',n:0},a.math.push(c)}},'']}},loader:{load:['[tex]/noerrors']}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js id=MathJax-script></script><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body lang=ja-jp class="sans-serif w-90 w-60-ns center center-ns mv2 mv5-ns" itemscope itemtype=http://schema.org/Article><span class=b>/</span>
<a href=https://nineties.github.io/manifold-optimization/ class="b bb bw1 pb1 no-underline black">Manifold Optimization</a><section id=main class=mt5><h1 itemprop=name id=title>10. 直線探索</h1><article itemprop=articleBody id=content class="w-90 lh-copy"><p>続いて、レトラクションを用いた直線探索の更新式</p><p>$$ x_{k+1} = R_{x_k}(t_kv_k) $$</p><p>の <strong>探索方向(search direction)</strong> $v_k$ と、 <strong>ステップサイズ(step size)</strong> $t_k$ をどのように選ぶべきかについて調べる。
これらは反復法が収束する事や収束先が停留点であるといった性質を持つように選ぶ必要がある。</p><p>ところで、多様体は位相空間であるので点列の収束は以下のように定義される。</p><div class=box><div class=title>定義10.1: 点列の収束(近傍を用いた定義)</div><p>多様体 $\mathcal{M}$ 上の点列 $\{x_k\}$ が点 $x_\ast$ に <strong>収束する(convergent)</strong> とは、任意の $x_\ast$ の近傍 $U$ に対して十分大きな $K$ を取れば、
$x_{K+1},x_{K+2},\ldots \in U$ となること。</p><p>$x_\ast$ を $\{x_k\}$ の <strong>極限(limit)</strong> と呼び$\displaystyle\lim_{k\rightarrow\infty}x_k$ と書く。
また $\{x_k\}$ の無限部分列が $x\in\mathcal{M}$ に収束するならば $x$ をこの点列の <strong>集積点(accumulation point)</strong> と呼び、 $\{x_k\}$ の集積点の集合を <strong>極限集合(limit set)</strong> という。</p></div><p>この定義をチャートを用いて書き直すと以下のようになる。</p><div class=box><div class=title>定義10.2: 点列の収束(チャートを用いた定義)</div><p>多様体 $\mathcal{M}$ 上の点列 $\{x_k\}$ が点 $x_\ast$ に収束するとは、あるチャート $(U,\psi), x_\ast\in U$ が存在して、十分大きな $K$ を取れば
$x_{K+1},x_{K+2},\ldots \in U$ であり、対応するユークリッド空間の点列 $\psi(x_{K+1}),\psi(x_{K+2}),\ldots$ が $\psi(x_\ast)$ に収束すること。</p></div><p>位相空間の極限に関する性質は同じく多様体についても(もちろん)成立。重要なものは以下。</p><div class=box><div class=title>命題10.3</div><p>(ハウスドルフ空間である) 多様体 $\mathcal{M}$ 上の任意の収束する点列についてその極限は一意に定まる。</p></div><div class=box><div class=title>命題10.4</div><p>多様体 $\mathcal{M},\mathcal{N}$ の間の写像 $f:\mathcal{M}\rightarrow\mathcal{N}$ が連続であるならば、任意の収束する$\mathcal{M}$の点列 $\{x_k\}$ に対して</p><p>$$ \lim_{k\rightarrow\infty} f(x_k) = f\left(\lim_{k\rightarrow\infty} x_k\right) $$</p></div><p>探索方向 $v_k$ は停留点以外では $f(x_k)$ が減少する方向を向いていて欲しい。<a href=https://press.princeton.edu/absil>Absil本</a>では $\{x_k\}$ に対する <strong>Gradient-related sequence</strong> になるように選ぶとあるが、取り扱いが面倒な割にほとんどの場合はここまで一般化する必要がないと思うので、 ここでは以下の条件を満たすように選ぶことにする。
(特に $k$ が小さいところでArmijo pointを求めるアルゴリズムがGradient-related sequenceであるだけだと条件が弱くて停止しない場合があると思う。私が間違ってたらどなたか教えてください。)</p><div class=box><div class=title>定義10.5: Sufficient descent condition</div><p>探索方向 $v$ はある定数 $\lambda > 0$ が存在して</p><p>$$ \langle\mathrm{grad} f(x), v\rangle \leq - \lambda||\mathrm{grad} f(x)||^2$$</p><p>が成立し、かつ $||v|| &lt; \infty$ であるように選ぶ。</p></div><p>ステップサイズ $t_k$ は以下のArmijo条件を満たすように取ると良い。</p><div class=box><div class=title>定義10.6: Armijo条件</div><p>リーマン多様体 $\mathcal{M}$、 滑らかな関数 $f:\mathcal{M}\rightarrow\mathbb{R}$、 レトラクション $R:T\mathcal{M}\rightarrow\mathcal{M}$、点 $x\in\mathcal{M}$、接ベクトル $v\in T_x\mathcal{M}$、定数 $c\in (0,1)$ についてステップサイズ $t > 0$ が</p><p>$$ f(R_x(t v)) \leq f(x) + c \langle\mathrm{grad}f(x),t v \rangle $$</p><p>を満たす時、 $t$ は <strong>Armijo条件(Armijo Condition)</strong> を満たすという。</p></div><p>Armijo条件は移動 $x\rightarrow R_x(tv)$ によって $f$ の値が十分減少する事を要求する条件であり、求める減少の大きさはパラメータ $c\in(0,1)$ によって制御する。非常に小さな値 (例えば $10^{-4}$)が使われる事が多い。
ユークリッド空間 $\mathbb{R}$ 上の滑らかな関数 $y=f(x)$ に対するArmijo条件を図示すると下図のようになる。(もちろん、一般の多様体に対してこのような図示は難しい。)</p><figure><img src=../images/armijo.png></figure><p>Armijo条件を満たす $t$ を見つける方法としては、例えば以下のアルゴリズムがある。
(下記アルゴリズムで見つかる点をAbsil本ではArmijo Pointと呼んでいる。)</p><div class=box><div class=title>アルゴリズム10.7: ArmijoのBacktrackingアルゴリズム</div><p>$\alpha > 0$ を十分大きな定数、 $\beta \in (0, 1)$ とする。</p><ol><li>$t=\alpha$ とする。これがArmijo条件を満たすならば終了する。</li><li>$t \leftarrow \beta t$ とし1に戻る。</li></ol></div><p>$\alpha=1, \beta=1/2$ といった値がよく使われると思う。
もちろん、 $f(R_x(t v))$ が最も小さくなるような$t_\ast = \mathrm{argmin}_t f(R_x(t v))$ を厳密に求める事ができるならばそれでも良い。
Backtrackingアルゴリズムは以下の重要な性質を持つ。</p><div id=th.backtracking_halts style=padding-top:100px;margin-top:-100px></div><div class=box><div class=title>定理10.8</div><p>$f(x)$ が停留点でなく、 $\langle\mathrm{grad}f(x),v\rangle &lt; 0$ であるならば、 ArmijoのBacktrackingアルゴリズムは有限ステップで停止する。</p></div><p>【証明】背理法により示す。Backtrackingアルゴリズムが停止しないとすると、$n=0,1,2,\ldots$ に対して
$$ f(R_x(\alpha\beta^n v)) > f(x) + c \langle\mathrm{grad}f(x),\alpha\beta^n v \rangle $$
すなわち
$$ \frac{f(R_x(\alpha\beta^n v))-f(R_x(0))}{\beta^n} > c\alpha \langle\mathrm{grad}f(x),v \rangle \quad(\because R_x(0)=x)$$
が成立。ここで $n\rightarrow\infty$ の極限をとると</p><p>$$ \left.\frac{\mathrm{d}}{\mathrm{d}t} f(R_x(\alpha t v))\right|_{t=0} \geq c\alpha \langle\mathrm{grad}f(x),v \rangle$$</p><p>この左辺は</p><p>$$\left.\frac{\mathrm{d}}{\mathrm{d}t} f(R_x(\alpha t v))\right|_{t=0} = \mathrm{D}f(R_x(0))[\mathrm{D}R_x(0)[\alpha v]]=\mathrm{D}f(x)[\alpha v]=\langle\mathrm{grad}f(x),\alpha v\rangle = \alpha\langle\mathrm{grad}f(x),v\rangle$$</p><p>であるので</p><p>$$ \langle\mathrm{grad}f(x),v\rangle \geq c\langle\mathrm{grad}f(x),v \rangle$$</p><p>よって $c\in(0,1)$ より $\langle\mathrm{grad}f(x),v\rangle \geq 0$ となるがこれは矛盾。$\square$</p><hr><p>ところで、ユークリッド空間における直線探索ではステップサイズに対して <strong>Wolfe条件(Wolfe condition)</strong> と呼ばれる条件を課す事が多いが、一般の多様体に対してこの条件をそのまま考えることはできない。Wolfe条件というのは、$c' \in (c, 1)$ として</p><p>$$ \nabla f(x_k + t_kv_k)^Tv_k\geq \nabla f(x_k)^Tv_k $$</p><p>を満たすというもので、これを多様体に一般化すると</p><p>$$ \langle \mathrm{grad} f(R_{x_k}(t_kv_k)),v_k\rangle \geq \langle \mathrm{grad}f(x_k),v_k\rangle $$</p><p>と書けそうであるが、$\mathrm{grad} f(R_{x_k}(t_kv_k))$ と $v_k$ は同じ接ベクトル空間の元ではないので左辺の内積が定義されない。
Wolfe条件に相当する条件を扱うのは、後に説明するアフィン接続の概念が必要になる。</p><hr><p>さて、ではいよいよ直線探索のアルゴリズムの説明をする。(Absil本ではいきなり"Accelerated" Line Searchというフレームワークが紹介されるが、本ノートでは単純なものから説明する。)</p><div class=box><div class=title>アルゴリズム10.9: Backtracking Line Search</div><p>リーマン多様体 $\mathcal{M}$、滑らかな関数 $f: \mathcal{M}\rightarrow\mathbb{R}$ 、レトラクション $R:T\mathcal{M}\rightarrow\mathcal{M}$とする。</p><p>最初の点 $x_0\in\mathcal{M}$ を選び、$k=0,1,2,\ldots$ に対して以下を反復する。</p><ol><li>探索方向 $v_k\in T_{x_k}\mathcal{M}$ をSufficient descent conditionを満たすように選ぶ。</li><li>Armijo条件を満たすステップサイズ $t_k$ をBacktrackingアルゴリズムにより求める。</li><li>$x_{k+1} = R_{x_k}(t_kv_k)$ とする。</li></ol></div><div class=box><div class=title>定理10.10</div><p>Backtracking Line Searchアルゴリズムの生成する点列 $\{x_k\}$ が集積点を持つならばそれは $f$ の停留点である</p></div><p>【証明】
Armijo条件と $x_{k+1} = R_{x_k}(t_kv_k)$ より$ f(x_{k}) \geq f(x_{k+1})$であるので、$\{f(x_k)\}$ は $\mathbb{R}$ の単調減少列である。 部分列 $\{x_k\}_{k\in K}$ が $x_\ast$ に収束するならば、 $\{f(x_k)\}_{k\in K}$ は $f(x_\ast)$ に収束するが $f(x_k)$ が単調減少列であることより $\{f(x_k)\}$ 全体も $f(x_\ast)$ に収束する。また $f$ は滑らかな関数であるので、 $\{\mathrm{grad}f(x_k)\}$ は $\mathrm{grad}f(x_\ast)$ に収束する。</p><p>Armijo条件と探索方向の選び方より</p><p>$$ f(x_{k+1}) - f(x_k) \leq c t_k\langle\mathrm{grad}f(x_k),v_k \rangle \leq -c\lambda t_k ||\mathrm{grad}f(x_k)||^2 \leq 0 $$</p><p>であるが左辺が $k\rightarrow\infty$ で $0$ に収束するので</p><p>$$ \lim_{k\rightarrow\infty} t_k||\mathrm{grad}f(x_k)||^2 = 0$$</p><p>である。ここで $\mathrm{grad}f(x_\ast) \neq 0$ であるとすると $\lim_{k\rightarrow\infty}t_k=0$ が必要である。
従って、$k$ が十分大きければ$t_k=\alpha\beta^m,(m\geq 1)$ であり Backtrackingアルゴリズムの1ステップ前のステップサイズ $t_k/\beta$ ではArmijo条件が成立しないから</p><p>$$ f\left(R_{x_k}\left(\frac{t_k}{\beta} v_k\right)\right) > f(x_k) + c \frac{t_k}{\beta}\langle\mathrm{grad}f(x_k),v_k \rangle $$</p><p>となる。ここで</p><p>$$ v'_k = \frac{v_k}{||v_k||},\quad t'_k=\frac{t_k||v_k||}{\beta}$$</p><p>とおくと</p><p>$$\begin{aligned}
&\quad f(R_{x_k}(t'_kv'_k)) > f(x_k) + c t'_k\langle\mathrm{grad}f(x_k),v'_k \rangle \\<br>\Leftrightarrow &\quad \frac{f(R_{x_k}(t'_kv'_k))) - f(R_{x_k}(0v'_k))}{t'_k} > c\langle\mathrm{grad}f(x_k),v'_k\rangle
\end{aligned}$$</p><p>であるので、中間値の定理よりある $\tilde{t}\in (0,t'_k)$ が存在して</p><p>$$\begin{aligned}
& \quad \left.\frac{\mathrm{d}}{\mathrm{d}t} f(R_{x_k}(tv'_k)\right|_{t=\tilde{t}} > c\langle\mathrm{grad}f(x_k),v'_k\rangle \\<br>\Leftrightarrow & \quad \mathrm{D}f(R_{x_k}(\tilde{t}v'_k))[\mathrm{D}R_x(\tilde{t}v'_k)[v'_k]] > c\langle\mathrm{grad}f(x_k),v'_k\rangle \\<br>\Leftrightarrow & \quad \langle\mathrm{grad}f(x_k),v'_k\rangle > c\langle\mathrm{grad}f(x_k),v'_k\rangle \\<br>\Leftrightarrow & \quad (1-c)\langle\mathrm{grad}f(x_k),v'_k\rangle > 0
\end{aligned}$$</p></article></section><footer><div><p class="f6 gray mt6 lh-copy"></p></div></footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>