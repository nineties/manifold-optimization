<!doctype html><html lang=ja-jp prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=description content><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content><meta property="og:type" content="article"><meta property="og:description" content><meta property="og:title" content="8. レトラクション"><meta property="og:site_name" content="Manifold Optimization"><meta property="og:image" content><meta property="og:image:type" content="image/jpeg"><meta property="og:image:width" content><meta property="og:image:height" content><meta property="og:url" content="https://nineties.github.io/manifold-optimization/8-retractions/"><meta property="og:locale" content="ja-jp"><meta property="article:published_time" content="0001-01-01
"><meta property="article:modified_time" content="0001-01-01
"><title>8. レトラクション</title><link rel=canonical href=https://nineties.github.io/manifold-optimization/8-retractions/><link rel=stylesheet href=https://unpkg.com/tachyons@4.11.1/css/tachyons.min.css><link rel=stylesheet href=https://nineties.github.io/manifold-optimization/css/style.css><link rel=stylesheet href=https://nineties.github.io/manifold-optimization/css/custom.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/highlightjs@9.12.0/styles/github-gist.css><link rel=stylesheet type=text/css href=https://nineties.github.io/manifold-optimization/css/mathjax-style.css><script>MathJax={tex:{inlineMath:[['$','$']],displayMath:[['$$','$$']],processEscapes:!0,tags:"ams",autoload:{color:[],colorV2:['color']},packages:{'[+]':['noerrors']}},chtml:{matchFontHeight:!1,displayAlign:"left",displayIndent:"2em"},options:{renderActions:{find_script_mathtex:[10,function(a){for(const b of document.querySelectorAll('script[type^="math/tex"]')){const e=!!b.type.match(/; *mode=display/),c=new a.options.MathItem(b.textContent,a.inputJax[0],e),d=document.createTextNode('');b.parentNode.replaceChild(d,b),c.start={node:d,delim:'',n:0},c.end={node:d,delim:'',n:0},a.math.push(c)}},'']}},loader:{load:['[tex]/noerrors']}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js id=MathJax-script></script><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body lang=ja-jp class="sans-serif w-90 w-60-ns center center-ns mv2 mv5-ns" itemscope itemtype=http://schema.org/Article><span class=b>/</span>
<a href=https://nineties.github.io/manifold-optimization/ class="b bb bw1 pb1 no-underline black">Manifold Optimization</a><section id=main class=mt5><h1 itemprop=name id=title>8. レトラクション</h1><article itemprop=articleBody id=content class="w-90 lh-copy"><p>ユークリッド空間 $\mathbb{R}^n$ の関数 $f:\mathbb{R}^n\rightarrow\mathbb{R}$ に対する <strong>直線探索法(line-search method)</strong> とは点 $x_0\in\mathbb{R}^n$ から出発して、更新式</p><p>$$ x_{k+1}=x_k + t_kv_k $$</p><p>を反復し $f$ の極小値を求める方法。ここで $v_k$ は <strong>探索方向(search direction)</strong> と呼ばれるベクトル、 $t_k$ は <strong>ステップサイズ(step size)</strong> と呼ばれるスカラーであって、これらをどのように求めるかによって様々な最適化アルゴリズムが存在する。</p><p>これを多様体 $\mathcal{M}$ 上で行うためには、$v_k$ を点 $x_k$ での接ベクトル $T_{x_k}\mathcal{M}$ とし、 $\gamma$ を $\dot{\gamma}(0)=v_k$ となるような曲線とし、 $\gamma$ に沿って探索を行えば良い。</p><figure><img src=../images/linesearch.png></figure><p>ユークリッド空間での直線探索法と異なり、曲線 $\gamma$ の選び方という自由度が増えている。$\gamma$ を構成する方法は無数にあるが、レトラクションという写像を用いるのが一般的である。</p><div class=box><div class=title>定義8.1: レトラクション</div><p>接バンドル $T\mathcal{M}$ から $\mathcal{M}$ への滑らかな写像 $R:T\mathcal{M}\rightarrow\mathcal{M}$ で以下の条件を満たすものを <strong>レトラクション(retraction)</strong> という。 $R$ の $T_x\mathcal{M}$ への制限を $R_x:T_x\mathcal{M}\rightarrow\mathcal{M}$ と書く。</p><ol><li>$R_x(0) = x$</li><li><strong>局所剛性(local rigidity)</strong> : $\mathrm{D}_{R_x}(0)=\mathrm{id}_{T_x\mathcal{M}}$</li></ol></div><p>$\mathrm{D}_{R_x}(0)$ は $T_x\mathcal{M}$の接ベクトル空間 $T_0T_x\mathcal{M}$ から $T_x\mathcal{M}$ への写像
$$ \mathrm{D}_{R_x}(0): T_0T_x\mathcal{M}\rightarrow T_x\mathcal{M} $$
であるが、$T_x\mathcal{M}$ はベクトル空間だから $T_0T_x\mathcal{M}\simeq T_x\mathcal{M}$ であるので
$$ \mathrm{D}_{R_x}(0): T_x\mathcal{M}\rightarrow T_x\mathcal{M} $$
として上の定義では扱っている。</p><p>そして局所剛性は、任意の $v\in T_x\mathcal{M}$ に対して</p><p>$$\mathrm{D}_{R_x}(0)[v] = v$$</p><p>であるということ。レトラクションが与えられると、直線探索を行うのに必要な曲線を以下のようにして構成することができる。</p><div class=box><div class=title>命題8.2</div><p>$R:T\mathcal{M}\rightarrow\mathcal{M}$ をレトラクションとする。接ベクトル $v\in T_x\mathcal{M}$ に対して曲線を
$$ \gamma(t) = R_x(tv) \quad t\in(-\varepsilon,\varepsilon)$$
と定めると
$$ \gamma(0) = x,\ \dot{\gamma}(0) = v $$</p></div><p>$\gamma:(-\varepsilon,\varepsilon)\rightarrow\mathcal{M}$ が滑らかな写像であるのは明らかであり $\gamma(0)=R_x(0) = x$ かつ</p><p>$$\dot{\gamma}(0) = \mathrm{D}_{R_x}(0)\left[\frac{\mathrm{d}(tv)}{\mathrm{d}t}(0)\right] = \mathrm{D}_{R_x}(0)[v]=v$$</p><figure><img src=../images/retraction.png></figure><p>$\mathcal{M}$ を多様体、 $\mathrm{R}$ を $\mathcal{M}$ の何らかのレトラクションとする。点 $x_k\in\mathcal{M}$ から接ベクトル $v_k\in T_{x_k}\mathcal{M}$ の方向にステップサイズ $t_k\in\mathbb{R}$ だけ進むという事は、更新式
$$ x_{k+1} = \mathrm{R}_{x_k}(t_kv_k) $$
によって表す事ができる。</p><p>このように、多様体上での最適化アルゴリズムはレトラクションの選び方によって変化し、効率的に計算できるレトラクションを見つける事が重要となる。</p><p>ちなみに、リーマ多様体には <strong>指数写像(exponential mapping)</strong> という自然に定まるレトラクションが存在するが、計算量が多く計算機で扱うのは難しい事が多い。</p><div class=box><div class=title>例8.3: ベクトル空間のレトラクション</div><p>ベクトル空間 $\mathcal{M}$ の点 $x$ と、接ベクトル $v\in T_x\mathcal{M}$ に対して、同型 $\mathcal{M}\simeq T_x\mathcal{M}$ を用いて
$$ R_x(v) = x + v $$
と定めると、これはレトラクションである。</p></div><p>$\mathcal{M}$ がベクトル空間の場合には(今定めたレトラクションを用いると)、更新式は</p><p>$$ x_{k+1} = \mathrm{R}_{x_k}(t_kv_k) = x_k + t_kv_k $$</p><p>となって、通常の直線探索と一致する。</p><p>続いて、$\mathcal{M}$ がベクトル空間 $\mathcal{V}$ の部分多様体である場合を考える。この場合も 点 $x\in\mathcal{M}$ と接ベクトル $v\in T_x\mathcal{M}$ の加算 $ x + v $ を$\mathcal{V}$ の中で求める事が出来る。従って $x+v$ を $\mathcal{M}$ の点に移す写像によってレトラクションを構成する事ができるが、以下がその写像が満たすべき条件となる。</p><div id=prop.retraction style=padding-top:100px;margin-top:-100px></div><div class=box><div class=title>命題8.4</div><p>$\mathcal{M}$ をベクトル空間 $\mathcal{V}$ の部分多様体とし、 $\mathcal{N}$ を
$$ \dim \mathcal{M} + \dim \mathcal{N} = \dim\mathcal{V} $$
であるような任意の多様体とする。
$ \phi: \mathcal{M}\times\mathcal{N}\rightarrow \mathcal{V} $
を埋め込みであり、かつある点 $e\in\mathcal{N}$ が存在して
$$ \phi(x,e) = x\quad \forall x\in\mathcal{M} $$
となるものであるとする。また $\pi:\mathcal{M}\times\mathcal{N}\rightarrow\mathcal{V}:\pi(x,y)=x$ とする。このとき
$$ R_x(v) = \pi(\phi^{-1}(x + v)) $$
は $x$ の近傍で $\mathcal{M}$ のレトラクションである。</p></div><div class=box><div class=title>例8.5: $n$次元球面のレトラクションの例</div><p>$S^n$ 上の点 $x$ と $v\in T_x S^n$ に対して
$$\mathrm{R}_x(v) = \frac{x+v}{||x+v||} $$</p></div><p>$\mathcal{M}=S^n, \mathcal{N}=\{r\in\mathbb{R}\mid r > 0\}$ に対して
$$\phi:S^n\times\mathcal{N}\rightarrow\mathbb{R}^{n+1}_\ast: (x,r) \mapsto rx $$
とおき
<a href=https://nineties.github.io/manifold-optimization/8-retractions/#prop.retraction>命題8.4</a>
を使用。</p><p>直交群やシュティーフェル多様体に対するレトラクションの同様の構成は行列のQR分解を利用して得られる。</p><div class=box><div class=title>命題8.6: QR分解</div><p>$U^+_{n}$ を $n\times n$ の実上三角行列で対角成分が全て正であるものの集合とする。</p><p>任意の $X\in\mathbb{R}^{m\times n}_\ast, (m\geq n)$ は</p><p>$$ X=QR\quad (Q\in \mathbb{R}^{m\times n}, R\in U^+_n, Q^TQ=I)$$
と一意に分解できる。この対応 $X\mapsto Q$ を $\mathrm{qf}(X)=Q$ と表記する。</p><figure><img src=../images/qr-factorization.png></figure></div><p>特に $m=n$ の時は $Q$ は直交行列となる。</p><div class=box><div class=title>例8.7: 直交群のQR分解によるレトラクション</div><p>直交群 $O_n$ の点 $X$ と $V=X\Omega\in T_XO_n$ に対して
$$ R_X(V) = \mathrm{qf}(X + V)=X\mathrm{qf}(I+\Omega) $$</p></div><p>$\mathcal{M}=O_n,\mathcal{N}=U^+_{n}$ に対して
$$ \phi: O_n\times U^+_n\rightarrow\mathbb{R}^{n\times n}_\ast: (Q,R)\rightarrow QR $$
とおく。$\dim O_n=n(n-1)/2, \dim U^+_n = n(n+1)/2$ より $\dim \mathbb{R}^{n\times n}_\ast = \dim O_n + \dim U^+_n$ なので
<a href=https://nineties.github.io/manifold-optimization/8-retractions/#prop.retraction>命題8.4</a>
が使える。</p><p>ここで
$$ T_XO_n = X\mathrm{Skew}_n=\{X\Omega\mid\Omega^T=-\Omega\}$$
であったので $V=X\Omega$ と書けるから
$$\mathrm{R}_X(X\Omega)=\mathrm{qf}(X+X\Omega)=X\mathrm{qf}(I+\Omega)\quad(\because\text{$X$は直交行列})$$</p><p>とも表せる。</p><p>シュティーフェル多様体へ一般化しても全く同様。</p><div class=box><div class=title>例8.8: シュティーフェル多様体のQR分解によるレトラクション</div><p>シュティーフェル多様体 $\mathrm{St}(p,n)$ の点 $X$ と $V=T_X\mathrm{St}(p,n)$ に対して
$$ R_X(V) = \mathrm{qf}(X + V)$$</p></div><p>このレトラクションを求める為には例えばシュミットの直交化法などのアルゴリズムを用いる。ちなみに $p=1$ の時は上で例示した $n-1$次元球面のレトラクションと一致する。</p><hr><p>QR分解ではなく極分解を用いる事もできる。</p><div class=box><div class=title>命題8.9: 極分解</div><p>$\mathrm{Sym}^+_n$ を$n\times n$正定値実対称行列の集合とする。</p><p>任意の $X\in\mathbb{R}^{m\times n}_\ast, (m\geq n)$ は</p><p>$$ X=UP\quad (U\in \mathbb{R}^{m\times n}, P\in \mathrm{Sym}^+_n, U^TU=I)$$
と一意に分解でき、
$$
U=X(X^TX)^{-\frac{1}{2}},\quad P=(X^TX)^{-\frac{1}{2}}
$$
である。</p></div><p>この分解に対して
<a href=https://nineties.github.io/manifold-optimization/8-retractions/#prop.retraction>命題8.4</a>
を用いると以下が示せる。</p><div class=box><div class=title>例8.10: 直交群の極分解によるレトラクション</div><p>直交群 $O_n$ の点 $X$ と $V=X\Omega\in T_XO_n$ に対して
$$ R_X(V) = X(I+\Omega)(I-\Omega^2)^{-1/2} $$</p></div><p>$ U = X(X^TX)^{-1/2}$ の $X$ に $X+V=X+X\Omega=X(I+\Omega)$ を代入して
$$\begin{aligned}
\mathrm{R}_X(X\Omega) &= X(I+\Omega)((X(I+\Omega))^TX(I+\Omega))^{-\frac{1}{2}} \\<br>&= X(I+\Omega)((I-\Omega)X^TX(I+\Omega))^{-\frac{1}{2}} \\<br>&= X(I+\Omega)(I-\Omega^2)^{-\frac{1}{2}} \quad(\because X^TX=I)\\<br>\end{aligned}$$</p><p>直交群の場合はQR分解に比べると計算量が多くあまり有用な場面はない。</p><div class=box><div class=title>例8.11: シュティーフェル多様体の極分解によるレトラクション</div><p>シュティーフェル多様体 $\mathrm{St}(p,n)$ の点 $X$ と $V=T_X\mathrm{St}(p,n)$ に対して
$$ R_X(V) = (X+V)(I+V^TV)^{-\frac{1}{2}} $$</p></div><p>$$ T_X\mathrm{St}(p,n)=\{Z\in\mathbb{R}^{n\times p}\mid Z^TX+X^TZ=0\}$$
であたので
$ U = X(X^TX)^{-1/2}$ の $X$ に $X+V$ を代入して
$$\begin{aligned}
\mathrm{R}_X() &= (X+V)((X+V)^T(X+V))^{-\frac{1}{2}} \\<br>&= (X+V)(X^TX + V^TV + V^TX+X^TV)^{-\frac{1}{2}} \\<br>&= (X+V)(I + V^TV)^{-\frac{1}{2}} \quad(\because X^TX=I,V^TX+X^TV=0)\\<br>\end{aligned}$$</p><div class=box><div class=title>例8.12: 直交群のCayley変換によるレトラクション</div><p>直交群 $O_n$ の点 $X$ と $V=X\Omega\in T_XO_n$ に対して
$$ \mathrm{R}_X(V)=X\left(I-\frac{1}{2}\Omega\right)^{-1}\left(I+\frac{1}{2}\Omega\right) $$</p></div><div class=box><div class=title>例8.13: 直交群のGivens回転によるレトラクション</div><p>単位行列の $(i,i)$成分と$(j,j)$成分を $\cos\theta$に、 $(i,j)$成分と$(j,i)$成分を$\sin\theta$ と $-\sin\theta$ に置き換えたものを <strong>ギブンズ回転(Givens rotation)</strong> という。これは $ij$平面での回転を表す。
$$G(i,j,\theta)=\begin{pmatrix}
1 & \cdots & 0 & \cdots & 0 & \cdots & 0 \\<br>\vdots & \ddots & \vdots & & \vdots & & \vdots \\<br>0 & \cdots & \cos\theta & \cdots & \sin\theta & \cdots & 0 \\<br>\vdots & & \vdots & \ddots & \vdots & & \vdots \\<br>0 & \cdots & -\sin\theta & \cdots & \cos\theta & \cdots & 0 \\<br>\vdots & & \vdots & & \vdots & \ddots & \vdots \\<br>0 & \cdots & 0 & \cdots & 0 & \cdots & 1 \\<br>\end{pmatrix}$$</p><p>直交群 $O_n$ の点 $X$ と $V=X\Omega\in T_XO_n$ に対して
$$\mathrm{R}_X(V)=X\mathrm{Giv}(\Omega)=\prod_{i&lt;j}G(i,j,\Omega_{ij})$$</p></div><div class=box><div class=title>例8.14: 直交群の指数写像によるレトラクション</div><p>直交群 $O_n$ の点 $X$ と $V=X\Omega\in T_XO_n$ に対して
$$\mathrm{R}_X(V)=X\exp\Omega = X\sum_{k=0}^\infty\frac{1}{k!}\Omega^k$$</p></div><p>続いて商多様体のレトラクションの構成方法について。</p><div class=box><div class=title>命題8.15</div><p>$\mathcal{M}$ を多様体 $\mathcal{M}/{\sim}$ をその商多様体、 $\pi:\mathcal{M}\rightarrow\mathcal{M}/{\sim}$ を自然な全射とする。</p><p>$\mathrm{R}:T\mathcal{M}\rightarrow\mathcal{M}$ を$\mathcal{M}$ のレトラクションであり、任意の
$v\in T_{[x]}\mathcal{M}/{\sim}$ とその点 $a,b\ ([a]=[b]=[x])$ への水平リフト $v_a,v_b$ に対して
$$ \pi(\mathrm{R}_a(v_a)) = \pi(\mathrm{R}_b(v_b)) $$
となるようなものであるならば、</p><p>$$ \mathrm{R}'_{[x]}(v) := \pi(\mathrm{R}_x(v_x)) $$</p><p>は代表元 $x$ の選び方によらずwell-definedであり、 $\mathcal{M}/{\sim}$ のレトラクションとなる。</p></div><div class=box><div class=title>例8.16: 実射影空間のレトラクション</div><p>実射影空間 $\mathbb{RP}^{n-1}=\mathbb{R}^n_\ast/\mathbb{R}_\ast$ の点 $[x]$ とベクトル $v\in T_{[x]}\mathbb{RP}^{n-1}$ について、 $v$ の点 $x$ での水平リフトを $v_x$ とすると
$$\mathrm{R}_{[x]}(v) = \pi(x + v_x)$$
はレトラクション。ただし $\pi:\mathbb{R}^n_\ast\rightarrow\mathbb{RP}^{n-1}$ は自然な全射。</p></div><p>$x\sim y$ とすると $y=\alpha x\quad(\alpha\in\mathbb{R}_\ast)$ と表す事ができる。この時 $v_{\alpha x}=\alpha v_x$ であったから</p><p>$$ \mathrm{R}_{[y]}(v)=\pi(y+v_y)=\pi(\alpha x + \alpha v_x) = \pi (x + v_x) = \mathrm{R}_{[x]}(v) $$</p><p>これはwell-defined。その他の条件については省略する。 $\square$</p><p>グラスマン多様体についても同様。</p><div class=box><div class=title>例8.17: グラスマン多様体のレトラクション</div><p>グラスマン多様体 $\mathrm{Grass}(p,n)=\mathbb{R}^{n\times p}_\ast/\mathrm{GL}_p$ の点 $[X]$とベクトル $V\in T\mathrm{Grass}(p,n)$ について $V$ の $X$ での水平リフトを $V_X$ とすると
$$ \mathrm{R}_{[X]}(V)=\mathrm{span}(X+V_X) $$
はレトラクション。ただし $\mathrm{span}:\mathbb{R}^{n\times p}_\ast\rightarrow\mathrm{Grass}(p,n)$ は自然な全射。</p></div><p>レトラクションの重要な性質として以下が成り立つ。つまり、 $\mathcal{M}$ 上での勾配を、ベクトル空間 $T_x\mathcal{M}$ の勾配として求める事が可能になる。</p><div class=box><div class=title>命題8.18</div><p>$\mathcal{M}$ がリーマン多様体である時、
滑らかな関数 $f:\mathcal{M}\rightarrow\mathbb{R}$ とレトラクション $R:T\mathcal{M}\rightarrow\mathcal{M}$ について
$$ \mathrm{grad}(f\circ R_x)(0) = \mathrm{grad} f(x) $$</p></div></article></section><footer><div><p class="f6 gray mt6 lh-copy"></p></div></footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>